<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"wuyongjiang13.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","width":240,"display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="一、目的探究下面代码的实现： 12BeanFactory bf &#x3D; new XmlBeanFactory(new ClassPathResource(&quot;beanFactoryTest.xml&quot;));MyTestBean bean &#x3D; (MyTestBean) bf.getBean(&quot;myTestBean&quot;); 功能分析：  先读取配置文件beanFactor">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring源码解析-容器的基本用法">
<meta property="og:url" content="https://wuyongjiang13.github.io/2022/10/30/22-24-52/index.html">
<meta property="og:site_name" content="小吴的技术博客">
<meta property="og:description" content="一、目的探究下面代码的实现： 12BeanFactory bf &#x3D; new XmlBeanFactory(new ClassPathResource(&quot;beanFactoryTest.xml&quot;));MyTestBean bean &#x3D; (MyTestBean) bf.getBean(&quot;myTestBean&quot;); 功能分析：  先读取配置文件beanFactor">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.nlark.com/yuque/0/2022/png/22686116/1663747964451-7a7d0abf-4fc0-442d-98ac-300a3fe38a1f.png?x-oss-process=image/resize,w_937,limit_0#crop=0&crop=0&crop=1&crop=1&from=url&id=Lwfcg&margin=%5Bobject%20Object%5D&originHeight=778&originWidth=937&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=">
<meta property="article:published_time" content="2022-10-30T14:24:52.000Z">
<meta property="article:modified_time" content="2022-10-30T14:51:18.066Z">
<meta property="article:author" content="wuyongjiang">
<meta property="article:tag" content="Spring源码解析">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.nlark.com/yuque/0/2022/png/22686116/1663747964451-7a7d0abf-4fc0-442d-98ac-300a3fe38a1f.png?x-oss-process=image/resize,w_937,limit_0#crop=0&crop=0&crop=1&crop=1&from=url&id=Lwfcg&margin=%5Bobject%20Object%5D&originHeight=778&originWidth=937&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title=">

<link rel="canonical" href="https://wuyongjiang13.github.io/2022/10/30/22-24-52/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>Spring源码解析-容器的基本用法 | 小吴的技术博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">小吴的技术博客</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">从零开始</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://wuyongjiang13.github.io/2022/10/30/22-24-52/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avater.jpeg">
      <meta itemprop="name" content="wuyongjiang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="小吴的技术博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Spring源码解析-容器的基本用法
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2022-10-30 22:24:52 / 修改时间：22:51:18" itemprop="dateCreated datePublished" datetime="2022-10-30T22:24:52+08:00">2022-10-30</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="一、目的"><a href="#一、目的" class="headerlink" title="一、目的"></a>一、目的</h2><p>探究下面代码的实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BeanFactory</span> <span class="variable">bf</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XmlBeanFactory</span>(<span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;beanFactoryTest.xml&quot;</span>));</span><br><span class="line"><span class="type">MyTestBean</span> <span class="variable">bean</span> <span class="operator">=</span> (MyTestBean) bf.getBean(<span class="string">&quot;myTestBean&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>功能分析：</p>
<ul>
<li>先读取配置文件beanFactoryTest.xml</li>
<li>将读入流封装成Resource，解析出bean并且实例化</li>
<li>调用实例化后的实例</li>
</ul>
<span id="more"></span>

<h2 id="二、配置文件的读取和封装"><a href="#二、配置文件的读取和封装" class="headerlink" title="二、配置文件的读取和封装"></a>二、配置文件的读取和封装</h2><h3 id="2-1-URL-amp-Resource类"><a href="#2-1-URL-amp-Resource类" class="headerlink" title="2.1 URL &amp; Resource类"></a>2.1 URL &amp; Resource类</h3><p>Java中，将不同来源的资源<strong>抽象成URL</strong>，通过注册不同的hanlder（URLStreamHandler）来处理不同来源的资源的读取逻辑。一般handler的类型使用不同前缀（协议，protocol）来识别，如”file:”，”http:”。<br />但是URL没有默认定义相对Classpath或者ServletContext等资源的handler。因而Spring对其内部使用到的资源实现了自己的抽象结构：<strong>Resource</strong>接口，<strong>来封装底层资源。</strong><br /><strong>不同来源的资源文件都有其相应的Resource实现</strong>：</p>
<ul>
<li>文件（FileSystemResource）：以<strong>文件系统绝对路径</strong>的方式进行访问</li>
<li>ClassPath资源（ClassPathResource）：以<strong>类路径</strong>的方式进行访问    </li>
<li>URL资源（Url Resource）：通过<strong>java.net.URL</strong>来访问资源</li>
<li>ServletContextResource：以相对于<strong>Web应用根目录</strong>的方式进行访问</li>
<li>Input资源（InputStreamResource）</li>
<li>Byte数组（ByteArrayResource）</li>
</ul>
<p><img src="https://cdn.nlark.com/yuque/0/2022/png/22686116/1663747964451-7a7d0abf-4fc0-442d-98ac-300a3fe38a1f.png?x-oss-process=image/resize,w_937,limit_0#crop=0&crop=0&crop=1&crop=1&from=url&id=Lwfcg&margin=%5Bobject%20Object%5D&originHeight=778&originWidth=937&originalType=binary&ratio=1&rotation=0&showTitle=false&status=done&style=none&title="></p>
<h3 id="2-2-InputStreamSource"><a href="#2-2-InputStreamSource" class="headerlink" title="2.2 InputStreamSource"></a>2.2 InputStreamSource</h3><p>所有Resource类都实现了<code>InputStreamSource</code>接口，都可以调用<code>getInputStream()</code>获取输入流。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">InputStreamSource</span> &#123;</span><br><span class="line">    <span class="comment">//返回一个InputStream对象</span></span><br><span class="line">    InputStream <span class="title function_">getInputStream</span><span class="params">()</span> <span class="keyword">throws</span> IOException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p> 每次调用这个方法都会得到一个<strong>新的流</strong>。</p>
<h3 id="2-3-Resource接口"><a href="#2-3-Resource接口" class="headerlink" title="2.3 Resource接口"></a>2.3 Resource接口</h3><p>用于获取各种资源。通过<code>getInputStream()</code>定位和打开resource，返回<code>InputStream</code>来读取资源，封装成对应的Resource实现类。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Resource</span> <span class="keyword">extends</span> <span class="title class_">InputStreamSource</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="type">boolean</span> <span class="title function_">exists</span><span class="params">()</span>;</span><br><span class="line">	<span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">isReadable</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> exists();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">isOpen</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">default</span> <span class="type">boolean</span> <span class="title function_">isFile</span><span class="params">()</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	URL <span class="title function_">getURL</span><span class="params">()</span> <span class="keyword">throws</span> IOException;</span><br><span class="line">	URI <span class="title function_">getURI</span><span class="params">()</span> <span class="keyword">throws</span> IOException;</span><br><span class="line">	File <span class="title function_">getFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException;</span><br><span class="line">	<span class="keyword">default</span> ReadableByteChannel <span class="title function_">readableChannel</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">		<span class="keyword">return</span> Channels.newChannel(getInputStream());</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="type">long</span> <span class="title function_">contentLength</span><span class="params">()</span> <span class="keyword">throws</span> IOException;</span><br><span class="line">	<span class="type">long</span> <span class="title function_">lastModified</span><span class="params">()</span> <span class="keyword">throws</span> IOException;</span><br><span class="line">	Resource <span class="title function_">createRelative</span><span class="params">(String relativePath)</span> <span class="keyword">throws</span> IOException;</span><br><span class="line">	<span class="meta">@Nullable</span></span><br><span class="line">	String <span class="title function_">getFilename</span><span class="params">()</span>;</span><br><span class="line">	String <span class="title function_">getDescription</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><code>getInputStream()</code>：定位和打开resource，返回InputStream来读取资源，调用者负责关闭</li>
<li><code>exists()</code>：判断资源是否存在</li>
<li><code>isOpen()</code>：判断资源是不是已经存在一个open stream 处理器。InputStream不能被多次读取，如果true，那么此次的读取会被关闭，避免资源泄露。</li>
<li><code>getDescription()</code>：返回对资源的描述，用处错误输出，通常返回resource URL的全名。<h3 id="2-4-ClassPathResource"><a href="#2-4-ClassPathResource" class="headerlink" title="2.4 ClassPathResource"></a>2.4 ClassPathResource</h3>重写<code>getInputStream()</code>，通过class或者classloader提供的底层方法进行调用<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> InputStream <span class="title function_">getInputStream</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    InputStream is;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.clazz != <span class="literal">null</span>) &#123;</span><br><span class="line">        is = <span class="built_in">this</span>.clazz.getResourceAsStream(<span class="built_in">this</span>.path);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.classLoader != <span class="literal">null</span>) &#123;</span><br><span class="line">        is = <span class="built_in">this</span>.classLoader.getResourceAsStream(<span class="built_in">this</span>.path);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        is = ClassLoader.getSystemResourceAsStream(<span class="built_in">this</span>.path);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (is == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FileNotFoundException</span>(getDescription() + <span class="string">&quot; cannot be opened because it does not exist&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> is;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="三、XmlBeanFactory的实现"><a href="#三、XmlBeanFactory的实现" class="headerlink" title="三、XmlBeanFactory的实现"></a>三、XmlBeanFactory的实现</h2><h3 id="3-1-XmlBeanFactory-初始化"><a href="#3-1-XmlBeanFactory-初始化" class="headerlink" title="3.1 XmlBeanFactory 初始化"></a>3.1 XmlBeanFactory 初始化</h3><p>调用ClassPathResource 的构造函数来构造一个Resource资源文件的实例对象。<br />XmlBeanDefinitionReader：对配置文件的读取工作<br />XmlBeanFactory的初始化过程：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">XmlBeanFactory</span> <span class="keyword">extends</span> <span class="title class_">DefaultListableBeanFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="type">XmlBeanDefinitionReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XmlBeanDefinitionReader</span>(<span class="built_in">this</span>);</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">XmlBeanFactory</span><span class="params">(Resource resource)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">		<span class="built_in">this</span>(resource, <span class="literal">null</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="title function_">XmlBeanFactory</span><span class="params">(Resource resource, BeanFactory parentBeanFactory)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">		<span class="built_in">super</span>(parentBeanFactory);</span><br><span class="line">		<span class="built_in">this</span>.reader.loadBeanDefinitions(resource);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>super(parentBeanFactory)</code>调用父类构造函数初始化的过程，跟踪代码<code>AbstractAutowireCapableBeanFactory.java</code>的构造函数中：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">AbstractAutowireCapableBeanFactory</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="built_in">super</span>();</span><br><span class="line">    ignoreDependencyInterface(BeanNameAware.class);</span><br><span class="line">    ignoreDependencyInterface(BeanFactoryAware.class);</span><br><span class="line">    ignoreDependencyInterface(BeanClassLoaderAware.class);</span><br><span class="line">    <span class="keyword">if</span> (NativeDetector.inNativeImage()) &#123;</span><br><span class="line">        <span class="built_in">this</span>.instantiationStrategy = <span class="keyword">new</span> <span class="title class_">SimpleInstantiationStrategy</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.instantiationStrategy = <span class="keyword">new</span> <span class="title class_">CglibSubclassingInstantiationStrategy</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>ignoreDependencyInterface：<strong>自动装配时忽略给定的依赖接口</strong>，典型应用是通过其他方式解析Application上下文注册依赖，类似于<strong>BeanFactory通过BeanFactoryAware进行注入</strong>或者<strong>ApplicationContext通过ApplicationContextAware进行注入</strong>。</li>
</ul>
<p><code>this.reader.loadBeanDefinitions(resource)</code>是对资源加载的真正实现。</p>
<h4 id="3-1-1-自动装配"><a href="#3-1-1-自动装配" class="headerlink" title="3.1.1 自动装配"></a>3.1.1 自动装配</h4><p>自动装配就是让应用程序为你找出依赖项的过程。Spring会在上下文中自动查找，并自动给bean装配与其关联的属性。<br />两种实现方式：xml文件 &amp; 注解<br />1）手动装配</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;cat&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.kuang.pojo.Cat&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dog&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.kuang.pojo.Dog&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;people&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.kuang.pojo.Peopel&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;张三&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;cat&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;cat&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dog&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dog&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2）通过xml文件实现自动装配<br />只需要在xml配置文件中的bean标签中加入一个属性<code>autowire</code>即可。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">&quot;people&quot;</span> class=<span class="string">&quot;com.kuang.pojo.Peopel&quot;</span> autowire=<span class="string">&quot;byName&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;name&quot;</span> value=<span class="string">&quot;张三&quot;</span>/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
<p>自动装配方式有：byName, byType, constructor, default, no</p>
<ul>
<li>byName（id属性）：Spring会根据class属性找到实体类，然后查询实体类中所有<strong>setter方法</strong>的名字（setDog），再到配置文件中寻找一个与该名字<strong>相同id</strong>（dog）的Bean，注入进来。</li>
<li>byType（class属性）：Spring会自动寻找一个与该属性类型相同（Dog.class）的Bean，注入进来。必须保证配置文件中所有bean的<strong>class属性</strong>的值是<strong>唯一</strong>的，否则会报错。</li>
</ul>
<p>3）通过注解实现自动装配<br />使用注解，xml文件要使用如下的文件头</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>&lt;context:annotation-config/&gt;</code>用来开启注解的支持</p>
<ol>
<li><strong>@Autowired</strong></li>
</ol>
<p>在People类的对应字段上添加注解（也可以在setter上），如果声明在字段上，不需要再些setter方法，但是本质上，该对象还是作为setter方法的实参注入进来的。</p>
<ul>
<li><p>Autowired装配属性的过程：spring会优先根据属性类型去容器中找对应的bean，找到就赋值。若找到多个相同类型的bean，在将属性名称作为bean的id去容器中查找。（<strong>先byType，若有多个实现时再byName</strong>）</p>
</li>
<li><p>**@Qualifier **可以和Autowired搭配使用：@Qualifier指定装配组件的id</p>
<ul>
<li>当byType找到多个相同类型的bean，再根据byName找不到对应的bean时，就使用这个注解<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Peopel</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier(value = &quot;cat&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Cat cat;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>默认情况下使用Autowired进行自动注入时，Spring容器中候选Bean必须有且只有一个。当找不到时会抛出<code>BeanCreationException</code>异常。可以使用<code>@Autowired(required=false)</code>，声明匹配不到也不会报错。</p>
</li>
</ul>
<ol start="2">
<li><strong>@Resource</strong></li>
</ol>
<p>默认先根据ByName进行注入，若<strong>没有匹配</strong>再根据byType去查找。再找不到就报错。</p>
<ul>
<li>有两个属性：name和type。如果单一指定（name/type），则根据一种方式（byName/byType）去匹配；如果全部指定，则需要名字和类型同时匹配成功。</li>
</ul>
<p>@Autowired时Spring定义的，@Resource时java规范。</p>
<h3 id="3-2-加载bean"><a href="#3-2-加载bean" class="headerlink" title="3.2 加载bean"></a>3.2 加载bean</h3><p>1）时序：</p>
<ul>
<li><p>封装资源文件：当进入<strong>XmlBeanDefinitionReader</strong>后首先对参数<code>Resource</code>使用<code>**EncodedResource**</code>类进行<strong>封装</strong>。</p>
</li>
<li><p>构造InputSource：从Resource中获取对应的<code>InputStream</code>并构造<code>InputSource</code>，用来将xml文件读取为Document。</p>
<ul>
<li>InputSource这个类并不来自于Spring，全路径是org.xml.sax.InputSource</li>
</ul>
</li>
<li><p>通过构造的InputSource实例和Resource实例继续调用函数<code>doLoadBeanDefinitions</code>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="comment">//使用EncodedResource封装Resource</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">loadBeanDefinitions</span><span class="params">(Resource resource)</span> <span class="keyword">throws</span> BeanDefinitionStoreException &#123;</span><br><span class="line">    <span class="keyword">return</span> loadBeanDefinitions(<span class="keyword">new</span> <span class="title class_">EncodedResource</span>(resource));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">loadBeanDefinitions</span><span class="params">(EncodedResource encodedResource)</span> <span class="keyword">throws</span> BeanDefinitionStoreException &#123;</span><br><span class="line">    Assert.notNull(encodedResource, <span class="string">&quot;EncodedResource must not be null&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">        logger.trace(<span class="string">&quot;Loading XML bean definitions from &quot;</span> + encodedResource);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//通过属性来记录已经加载的资源</span></span><br><span class="line">    Set&lt;EncodedResource&gt; currentResources = <span class="built_in">this</span>.resourcesCurrentlyBeingLoaded.get();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!currentResources.add(encodedResource)) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanDefinitionStoreException</span>(</span><br><span class="line">            <span class="string">&quot;Detected cyclic loading of &quot;</span> + encodedResource + <span class="string">&quot; - check your import definitions!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//从Resource中获取对应的InputStream</span></span><br><span class="line">    <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">inputStream</span> <span class="operator">=</span> encodedResource.getResource().getInputStream()) &#123;</span><br><span class="line">        <span class="comment">//使用InputStream构造InputSource</span></span><br><span class="line">        <span class="type">InputSource</span> <span class="variable">inputSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputSource</span>(inputStream);</span><br><span class="line">        <span class="keyword">if</span> (encodedResource.getEncoding() != <span class="literal">null</span>) &#123;</span><br><span class="line">            inputSource.setEncoding(encodedResource.getEncoding());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//继续调用doLoadBeanDefinitions,逻辑核心部分</span></span><br><span class="line">        <span class="keyword">return</span> doLoadBeanDefinitions(inputSource, encodedResource.getResource());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanDefinitionStoreException</span>(</span><br><span class="line">            <span class="string">&quot;IOException parsing XML document from &quot;</span> + encodedResource.getResource(), ex);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">        currentResources.remove(encodedResource);</span><br><span class="line">        <span class="keyword">if</span> (currentResources.isEmpty()) &#123;</span><br><span class="line">            <span class="built_in">this</span>.resourcesCurrentlyBeingLoaded.remove();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2）EncodedResource：对资源文件的编码进行处理<br />主要逻辑：当设置了编码属性的时候Spring会使用相应的编码作为输入流的编码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Reader <span class="title function_">getReader</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.charset != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(<span class="built_in">this</span>.resource.getInputStream(), <span class="built_in">this</span>.charset);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">this</span>.encoding != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(<span class="built_in">this</span>.resource.getInputStream(), <span class="built_in">this</span>.encoding);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(<span class="built_in">this</span>.resource.getInputStream());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>3）doLoadBeanDefinitions()</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="type">int</span> <span class="title function_">doLoadBeanDefinitions</span><span class="params">(InputSource inputSource, Resource resource)</span></span><br><span class="line">    <span class="keyword">throws</span> BeanDefinitionStoreException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//获取XML文件的验证模式，加载XML文件并得到对应的Document</span></span><br><span class="line">        <span class="type">Document</span> <span class="variable">doc</span> <span class="operator">=</span> doLoadDocument(inputSource, resource);</span><br><span class="line">        <span class="comment">//根据返回的Document注册Bean信息</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> registerBeanDefinitions(doc, resource);</span><br><span class="line">        <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">            logger.debug(<span class="string">&quot;Loaded &quot;</span> + count + <span class="string">&quot; bean definitions from &quot;</span> + resource);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (BeanDefinitionStoreException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> ex;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (SAXParseException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">XmlBeanDefinitionStoreException</span>(resource.getDescription(),</span><br><span class="line">                                                  <span class="string">&quot;Line &quot;</span> + ex.getLineNumber() + <span class="string">&quot; in XML document from &quot;</span> + resource + <span class="string">&quot; is invalid&quot;</span>, ex);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (SAXException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">XmlBeanDefinitionStoreException</span>(resource.getDescription(),</span><br><span class="line">                                                  <span class="string">&quot;XML document from &quot;</span> + resource + <span class="string">&quot; is invalid&quot;</span>, ex);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (ParserConfigurationException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanDefinitionStoreException</span>(resource.getDescription(),</span><br><span class="line">                                               <span class="string">&quot;Parser configuration exception parsing XML from &quot;</span> + resource, ex);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanDefinitionStoreException</span>(resource.getDescription(),</span><br><span class="line">                                               <span class="string">&quot;IOException parsing XML document from &quot;</span> + resource, ex);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanDefinitionStoreException</span>(resource.getDescription(),</span><br><span class="line">                                               <span class="string">&quot;Unexpected exception parsing XML document from &quot;</span> + resource, ex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">protected</span> Document <span class="title function_">doLoadDocument</span><span class="params">(InputSource inputSource, Resource resource)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.documentLoader.loadDocument(inputSource, getEntityResolver(), <span class="built_in">this</span>.errorHandler,</span><br><span class="line">                                            getValidationModeForResource(resource), isNamespaceAware());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>获取对XML文件的验证模式</p>
</li>
<li><p>加载XML文件，并得到对应的Document</p>
</li>
<li><p>根据返回的Document注册Bean信息</p>
<h4 id="3-2-1-XML的验证模式-amp-获取"><a href="#3-2-1-XML的验证模式-amp-获取" class="headerlink" title="3.2.1 XML的验证模式 &amp; 获取"></a>3.2.1 XML的验证模式 &amp; 获取</h4><p>1）**DTD **（有DOCTYPE）<br />DTD（Document Type Definition）文档类型定义。是一种保证XML文档格式正确的有效方法，可以通过比较XML文档和DTD文件来查看文档是否符合规范，元素和标签是否使用正确。<br />需要在XML文件的头部声明。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">beans</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//SPRING//DTD BEAN 2.0//EN&quot;</span> <span class="string">&quot;https://www.springframework.org/dtd/spring-beans-2.0.dtd&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>2）<strong>XSD</strong>（无DOCTYPE）<br /><strong>XML Schema</strong>语言就是XSD（XML Schema Definition）。描述了XML文档的结构。<br />可以使用一个指定的XML Schema来验证某个XML文档，以检查该XML文档是否符合其要求。XML Schema本身就是XML文档，符合XML语法结构。</p>
</li>
<li><p>需要声明名称空间(xmlns:xsi=”<a target="_blank" rel="noopener" href="http://www.w3.org/2001/XMLSchema-instance&quot;">http://www.w3.org/2001/XMLSchema-instance&quot;</a>)</p>
</li>
<li><p>通过<code>schemaLocation</code>属性来指定名称空间所对应的XML Schema文档的存储位置。(xsi:schemaLocation=”<a target="_blank" rel="noopener" href="http://www.springframework.org/schema/beans">http://www.springframework.org/schema/beans</a>…)</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>3）获取XML的验证模式<br /><strong>Spring用来检测验证模式的办法就是判断是否包含 DOCTYPE，如果包含就是DTD，否则就是XSD</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="type">int</span> <span class="title function_">getValidationModeForResource</span><span class="params">(Resource resource)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">validationModeToUse</span> <span class="operator">=</span> getValidationMode();</span><br><span class="line">    <span class="comment">//如果手动指定了验证模式则使用指定的验证模式</span></span><br><span class="line">    <span class="keyword">if</span> (validationModeToUse != VALIDATION_AUTO) &#123;</span><br><span class="line">        <span class="keyword">return</span> validationModeToUse;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果未指定则使用自动检测</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">detectedMode</span> <span class="operator">=</span> detectValidationMode(resource);</span><br><span class="line">    <span class="keyword">if</span> (detectedMode != VALIDATION_AUTO) &#123;</span><br><span class="line">        <span class="keyword">return</span> detectedMode;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Hmm, we didn&#x27;t get a clear indication... Let&#x27;s assume XSD,</span></span><br><span class="line">    <span class="comment">// since apparently no DTD declaration has been found up until</span></span><br><span class="line">    <span class="comment">// detection stopped (before finding the document&#x27;s root tag).</span></span><br><span class="line">    <span class="keyword">return</span> VALIDATION_XSD;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以通过调用<code> XmlBeanDefinitionReader.setValidationMode()</code>来手动设定验证模式。<br />自动检测：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="type">int</span> <span class="title function_">detectValidationMode</span><span class="params">(Resource resource)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (resource.isOpen()) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanDefinitionStoreException</span>(</span><br><span class="line">            <span class="string">&quot;Passed-in Resource [&quot;</span> + resource + <span class="string">&quot;] contains an open stream: &quot;</span> +</span><br><span class="line">            <span class="string">&quot;cannot determine validation mode automatically. Either pass in a Resource &quot;</span> +</span><br><span class="line">            <span class="string">&quot;that is able to create fresh streams, or explicitly specify the validationMode &quot;</span> +</span><br><span class="line">            <span class="string">&quot;on your XmlBeanDefinitionReader instance.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    InputStream inputStream;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        inputStream = resource.getInputStream();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanDefinitionStoreException</span>(</span><br><span class="line">            <span class="string">&quot;Unable to determine validation mode for [&quot;</span> + resource + <span class="string">&quot;]: cannot open InputStream. &quot;</span> +</span><br><span class="line">            <span class="string">&quot;Did you attempt to load directly from a SAX InputSource without specifying the &quot;</span> +</span><br><span class="line">            <span class="string">&quot;validationMode on your XmlBeanDefinitionReader instance?&quot;</span>, ex);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.validationModeDetector.detectValidationMode(inputStream);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (IOException ex) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanDefinitionStoreException</span>(<span class="string">&quot;Unable to determine validation mode for [&quot;</span> +</span><br><span class="line">                                               resource + <span class="string">&quot;]: an error occurred whilst reading from the InputStream.&quot;</span>, ex);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将自动检测验证模式的工作委托给了专门的处理类<code>XmlValidationModeDetector</code>，调用<code>validationModeDetector()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">detectValidationMode</span><span class="params">(InputStream inputStream)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// Peek into the file to look for DOCTYPE.</span></span><br><span class="line">    <span class="keyword">try</span> (<span class="type">BufferedReader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(inputStream))) &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">isDtdValidated</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">        String content;</span><br><span class="line">        <span class="keyword">while</span> ((content = reader.readLine()) != <span class="literal">null</span>) &#123;</span><br><span class="line">            content = consumeCommentTokens(content);</span><br><span class="line">            <span class="comment">//如果读取的行是空或者是注释则略过</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">this</span>.inComment || !StringUtils.hasText(content)) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//是否包含 DOCTYPE</span></span><br><span class="line">            <span class="keyword">if</span> (hasDoctype(content)) &#123;</span><br><span class="line">                isDtdValidated = <span class="literal">true</span>;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//读取到&lt;开始符号，验证模式一定在开始符号前</span></span><br><span class="line">            <span class="keyword">if</span> (hasOpeningTag(content)) &#123;</span><br><span class="line">                <span class="comment">// End of meaningful data...</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (isDtdValidated ? VALIDATION_DTD : VALIDATION_XSD);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (CharConversionException ex) &#123;</span><br><span class="line">        <span class="comment">// Choked on some character encoding...</span></span><br><span class="line">        <span class="comment">// Leave the decision up to the caller.</span></span><br><span class="line">        <span class="keyword">return</span> VALIDATION_AUTO;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-3-获取Document"><a href="#3-3-获取Document" class="headerlink" title="3.3 获取Document"></a>3.3 获取Document</h3><p>1）对文档的读取委托给了DocumentLoader去执行</p>
</li>
<li><p>接口：DocumentLoader</p>
</li>
<li><p>实现类：DefaultDocumentLoader</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> Document <span class="title function_">loadDocument</span><span class="params">(InputSource inputSource, EntityResolver entityResolver,</span></span><br><span class="line"><span class="params">                             ErrorHandler errorHandler, <span class="type">int</span> validationMode, <span class="type">boolean</span> namespaceAware)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">DocumentBuilderFactory</span> <span class="variable">factory</span> <span class="operator">=</span> createDocumentBuilderFactory(validationMode, namespaceAware);</span><br><span class="line">    <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">        logger.trace(<span class="string">&quot;Using JAXP provider [&quot;</span> + factory.getClass().getName() + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">DocumentBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> createDocumentBuilder(factory, entityResolver, errorHandler);</span><br><span class="line">    <span class="keyword">return</span> builder.parse(inputSource);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过SAX解析XML文档通过流程：</p>
</li>
<li><p>创建DocumentBuilderFactory</p>
</li>
<li><p>再通过DocumentBuilderFactory 创建 DocumentBuilder</p>
</li>
<li><p>再解析InputSource，返回Document对象</p>
<h4 id="3-3-1-EntityResolver-接口"><a href="#3-3-1-EntityResolver-接口" class="headerlink" title="3.3.1 EntityResolver 接口"></a>3.3.1 EntityResolver 接口</h4><p>1）介绍<br />如果SAX应用程序需要实现<strong>自定义处理外部实体</strong>，则必须实现此接口并使用<code>setEntityResolver</code>方法向SAX驱动器注册一个实例。<br />对于解析一个XML文档，SAX首先读取该文档的声明，通过声明去寻找相应的DTD定义，来对文档进行一个验证。</p>
</li>
<li><p>默认通过DTD的URL地址来下载对应的DTD声明，并进行认证。可能因为网络原因报错</p>
</li>
</ul>
<p><strong>EntityResolver的作用就是项目本身就可以提供一个寻找DTD声明的方法</strong>，即由程序来实现寻找DTD声明的过程。比如将DTD文件放到项目中的某处，在实现时直接将此文档读取并返回给SAX即可，避免了通过网络来寻找DTD的声明。<br />2）EntityResolver 接口声明的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> InputSource <span class="title function_">resolveEntity</span> <span class="params">(String publicId,</span></span><br><span class="line"><span class="params">                                           String systemId)</span></span><br><span class="line">    <span class="keyword">throws</span> SAXException, IOException;</span><br></pre></td></tr></table></figure>
<p>接受两个参数 publicId 和 systemId，并返回一个InputSource对象。</p>
<ul>
<li><p>解析XSD的配置文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="string"><span class="tag">    http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>publicId：null</li>
<li>systemId：<a target="_blank" rel="noopener" href="http://www.springframework.org/schema/beans/spring-beans.xsd">http://www.springframework.org/schema/beans/spring-beans.xsd</a></li>
</ul>
</li>
<li><p>解析DTD配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">beans</span> <span class="keyword">PUBLIC</span> <span class="string">&quot;-//SPRING//DTD BEAN 2.0//EN&quot;</span> <span class="string">&quot;https://www.springframework.org/dtd/spring-beans-2.0.dtd&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>publicId：-//SPRING//DTD BEAN 2.0//EN</li>
<li>systemId：<a target="_blank" rel="noopener" href="https://www.springframework.org/dtd/spring-beans-2.0.dtd">https://www.springframework.org/dtd/spring-beans-2.0.dtd</a></li>
</ul>
</li>
</ul>
<p>3）将网络URL转换为自己工程里对应的地址文件</p>
<ul>
<li><p><code>DelegatingEntityResolver.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> InputSource <span class="title function_">resolveEntity</span><span class="params">(<span class="meta">@Nullable</span> String publicId, <span class="meta">@Nullable</span> String systemId)</span></span><br><span class="line">    <span class="keyword">throws</span> SAXException, IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (systemId != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (systemId.endsWith(DTD_SUFFIX)) &#123;</span><br><span class="line">            <span class="comment">//如果是DTD从这里解析</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.dtdResolver.resolveEntity(publicId, systemId);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (systemId.endsWith(XSD_SUFFIX)) &#123;</span><br><span class="line">            <span class="comment">//如果是XSD从这里解析</span></span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.schemaResolver.resolveEntity(publicId, systemId);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Fall back to the parser&#x27;s default behavior.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">DelegatingEntityResolver</span><span class="params">(<span class="meta">@Nullable</span> ClassLoader classLoader)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.dtdResolver = <span class="keyword">new</span> <span class="title class_">BeansDtdResolver</span>();</span><br><span class="line">    <span class="built_in">this</span>.schemaResolver = <span class="keyword">new</span> <span class="title class_">PluggableSchemaResolver</span>(classLoader);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对不同的验证模式，Spring使用不同的解析器解析。</p>
</li>
<li><p>加载DTD类型的<code>BeanDtdResolver.resolveEntity</code>是直接截取systemId最后的xx.dtd，然后去当前路径下寻找</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">public</span> InputSource <span class="title function_">resolveEntity</span><span class="params">(<span class="meta">@Nullable</span> String publicId, <span class="meta">@Nullable</span> String systemId)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">        logger.trace(<span class="string">&quot;Trying to resolve XML entity with public ID [&quot;</span> + publicId +</span><br><span class="line">                     <span class="string">&quot;] and system ID [&quot;</span> + systemId + <span class="string">&quot;]&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//DTD_EXTENSION = &quot;.dtd&quot;</span></span><br><span class="line">    <span class="keyword">if</span> (systemId != <span class="literal">null</span> &amp;&amp; systemId.endsWith(DTD_EXTENSION)) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">lastPathSeparator</span> <span class="operator">=</span> systemId.lastIndexOf(<span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">dtdNameStart</span> <span class="operator">=</span> systemId.indexOf(DTD_NAME, lastPathSeparator);</span><br><span class="line">        <span class="keyword">if</span> (dtdNameStart != -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">dtdFile</span> <span class="operator">=</span> DTD_NAME + DTD_EXTENSION;</span><br><span class="line">            <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">                logger.trace(<span class="string">&quot;Trying to locate [&quot;</span> + dtdFile + <span class="string">&quot;] in Spring jar on classpath&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">Resource</span> <span class="variable">resource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(dtdFile, getClass());</span><br><span class="line">                <span class="type">InputSource</span> <span class="variable">source</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputSource</span>(resource.getInputStream());</span><br><span class="line">                source.setPublicId(publicId);</span><br><span class="line">                source.setSystemId(systemId);</span><br><span class="line">                <span class="keyword">if</span> (logger.isTraceEnabled()) &#123;</span><br><span class="line">                    logger.trace(<span class="string">&quot;Found beans DTD [&quot;</span> + systemId + <span class="string">&quot;] in classpath: &quot;</span> + dtdFile);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span> source;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (FileNotFoundException ex) &#123;</span><br><span class="line">                <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                    logger.debug(<span class="string">&quot;Could not resolve beans DTD [&quot;</span> + systemId + <span class="string">&quot;]: not found in classpath&quot;</span>, ex);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Fall back to the parser&#x27;s default behavior.</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>加载XSD类型的 <code>PluggableSchemaResolver.resolveEntity</code>是默认到<code>META-INF/Spring.schemas</code>文件中找到对应systemId所对应的XSD文件并加载</p>
</li>
</ul>
<p>4）bean加载过程中获取EntityResolver<br />在<code>loadDocument()</code>通过<code>getEntityResolver()</code>获取EntityResolver</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> EntityResolver <span class="title function_">getEntityResolver</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.entityResolver == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// Determine default EntityResolver to use.</span></span><br><span class="line">        <span class="type">ResourceLoader</span> <span class="variable">resourceLoader</span> <span class="operator">=</span> getResourceLoader();</span><br><span class="line">        <span class="keyword">if</span> (resourceLoader != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="built_in">this</span>.entityResolver = <span class="keyword">new</span> <span class="title class_">ResourceEntityResolver</span>(resourceLoader);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.entityResolver = <span class="keyword">new</span> <span class="title class_">DelegatingEntityResolver</span>(getBeanClassLoader());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>.entityResolver;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="3-4-解析及注册BeanDefinitions"><a href="#3-4-解析及注册BeanDefinitions" class="headerlink" title="3.4 解析及注册BeanDefinitions"></a>3.4 解析及注册BeanDefinitions</h3><p>当程序已经拥有XML文档文件的Document实例对象时，会调用下面的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(Document doc, Resource resource)</span> <span class="keyword">throws</span> BeanDefinitionStoreException &#123;</span><br><span class="line">    <span class="comment">//使用DefaultBeanDefinitionDocumentReader 实例化 BeanDefinitionDocumentReader</span></span><br><span class="line">    <span class="type">BeanDefinitionDocumentReader</span> <span class="variable">documentReader</span> <span class="operator">=</span> createBeanDefinitionDocumentReader();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//在实例化BeanDefinitionReader时候会将 BeanDefinitionRegistry 传入，默认使用继承自DefualtListableBeanFactory的子类</span></span><br><span class="line">    <span class="comment">//记录统计前BeanDefinition的加载个数</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">countBefore</span> <span class="operator">=</span> getRegistry().getBeanDefinitionCount();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//加载以及注册bean，并创建基于XML的readerContext，之后会传入用于资源方面的解析，这里面包含回调，错误处理等方面</span></span><br><span class="line">    documentReader.registerBeanDefinitions(doc, createReaderContext(resource));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//记录本次加载的BeanDefinition个数</span></span><br><span class="line">    <span class="keyword">return</span> getRegistry().getBeanDefinitionCount() - countBefore;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>BeanDefinitionDocumentReader</code>是一个接口，实例化为<code>DefaultBeanDefinitionDocumentReader</code>对象。<br />1）<code>DefaultBeanDefinitionDocumentReader.registerBeanDefinitions()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">registerBeanDefinitions</span><span class="params">(Document doc, XmlReaderContext readerContext)</span> &#123;</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="built_in">this</span>.readerContext = readerContext;</span><br><span class="line">    <span class="comment">//提取root</span></span><br><span class="line">    doRegisterBeanDefinitions(doc.getDocumentElement());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>提取root，作为参数继续BeanDefinititon的注册</li>
</ul>
<p>2）核心部分：<code>DefaultBeanDefinitionDocumentReader.doRegisterBeanDefinitions()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doRegisterBeanDefinitions</span><span class="params">(Element root)</span> &#123;</span><br><span class="line">    <span class="comment">//专门处理解析</span></span><br><span class="line">    <span class="type">BeanDefinitionParserDelegate</span> <span class="variable">parent</span> <span class="operator">=</span> <span class="built_in">this</span>.delegate;</span><br><span class="line">    <span class="built_in">this</span>.delegate = createDelegate(getReaderContext(), root, parent);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.delegate.isDefaultNamespace(root)) &#123;</span><br><span class="line">        <span class="comment">//处理profile属性</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">profileSpec</span> <span class="operator">=</span> root.getAttribute(PROFILE_ATTRIBUTE);</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.hasText(profileSpec)) &#123;</span><br><span class="line">            String[] specifiedProfiles = StringUtils.tokenizeToStringArray(</span><br><span class="line">                profileSpec, BeanDefinitionParserDelegate.MULTI_VALUE_ATTRIBUTE_DELIMITERS);</span><br><span class="line">            <span class="comment">// We cannot use Profiles.of(...) since profile expressions are not supported</span></span><br><span class="line">            <span class="comment">// in XML config. See SPR-12458 for details.</span></span><br><span class="line">            <span class="keyword">if</span> (!getReaderContext().getEnvironment().acceptsProfiles(specifiedProfiles)) &#123;</span><br><span class="line">                <span class="keyword">if</span> (logger.isDebugEnabled()) &#123;</span><br><span class="line">                    logger.debug(<span class="string">&quot;Skipped XML bean definition file due to specified profiles [&quot;</span> + profileSpec +</span><br><span class="line">                                 <span class="string">&quot;] not matching: &quot;</span> + getReaderContext().getResource());</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//解析前处理，留给子类实现</span></span><br><span class="line">    preProcessXml(root);</span><br><span class="line">    parseBeanDefinitions(root, <span class="built_in">this</span>.delegate);</span><br><span class="line">    <span class="comment">//解析后处理，留给子类实现</span></span><br><span class="line">    postProcessXml(root);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">this</span>.delegate = parent;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>3）<strong>注册并解析 BeanDefinition</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">parseBeanDefinitions</span><span class="params">(Element root, BeanDefinitionParserDelegate delegate)</span> &#123;</span><br><span class="line">    <span class="comment">//对beans的处理</span></span><br><span class="line">    <span class="keyword">if</span> (delegate.isDefaultNamespace(root)) &#123;</span><br><span class="line">        <span class="type">NodeList</span> <span class="variable">nl</span> <span class="operator">=</span> root.getChildNodes();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nl.getLength(); i++) &#123;</span><br><span class="line">            <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> nl.item(i);</span><br><span class="line">            <span class="keyword">if</span> (node <span class="keyword">instanceof</span> Element) &#123;</span><br><span class="line">                <span class="type">Element</span> <span class="variable">ele</span> <span class="operator">=</span> (Element) node;</span><br><span class="line">                <span class="keyword">if</span> (delegate.isDefaultNamespace(ele)) &#123;</span><br><span class="line">                    <span class="comment">//对默认bean的处理</span></span><br><span class="line">                    parseDefaultElement(ele, delegate);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="comment">//对自定义bean的处理</span></span><br><span class="line">                    delegate.parseCustomElement(ele);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        delegate.parseCustomElement(root);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Spring中有两类Bean声明</p>
<ul>
<li>一个是默认的：<code>&lt;bean id=&quot;test&quot; class=&quot;test.TestBean&quot;/&gt;</code></li>
<li>一类是自定义的：<code>&lt;tx:annotation-driven/&gt;</code></li>
</ul>
<p>如果是自定义的，需要用户实现一些接口及配置。<br />对于根节点或者子节点如果是<strong>默认命名空间</strong>的话则采用 <code>parseDefaultElement</code>方法进行解析，否者使用<code>delegate.parseCustomElement</code>方法对<strong>自定义命名空间</strong>进行解析。<br />通过<code>node.getNamespaceURI()</code>获取命名空间，并于spring中固定的命名空间<code>http://www.springframework.org/schema/beans</code>进行比对。</p>
<h4 id="3-4-1-profile属性的使用"><a href="#3-4-1-profile属性的使用" class="headerlink" title="3.4.1 profile属性的使用"></a>3.4.1 profile属性的使用</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">profile</span>=<span class="string">&quot;dev&quot;</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- should override the &#x27;foo&#x27; bean above when the &#x27;dev&#x27; profile is active --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;foo&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">value</span>=<span class="string">&quot;42&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- should only be available when the &#x27;dev&#x27; profile is active --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">name</span>=<span class="string">&quot;devOnlyBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;java.lang.Object&quot;</span>/&gt;</span></span><br><span class="line">&lt;/beans</span><br></pre></td></tr></table></figure>
<p>可以使用profile来使适用不同的环境，如生产环境，开发环境，测试环境<br />首先程序会获取beans节点是否定义了profile属性，如果定义了则需要到环境变量中去寻找。</p>
<ul>
<li>需要断言environment不可能为空，因为profile是可以同时指定多个的，需要程序对其拆分，并解析每个profile是否符合环境变量中所定义的。</li>
</ul>
<p>不定义则不会浪费性能去解析</p>
<h4 id="3-4-2-设计模式（委派模式）"><a href="#3-4-2-设计模式（委派模式）" class="headerlink" title="3.4.2  设计模式（委派模式）"></a>3.4.2  设计模式（委派模式）</h4><p>1）概念<br />委派模式：在做具体某件事的过程中，交给其他类来处理，只要结果符合我的预期就可以。<strong>负责任务的调用和分配，只关注结果</strong>。<br />模版模式与委派模式的区别：<strong>模版模式更关注步骤</strong>，公共部分会放在模版的骨架步骤中完成，针对子类可能会有一些特殊的操作就可以在特定步骤中重新实现，从模版模式中可以看到清晰的过程步骤<br />代理模式与委派模式的区别：可以看作一种特殊情况下的静态代理的全权代理，但是代理模式注重过程。<br />2）应用</p>
<ul>
<li><p>Spring IOC 对象实例化（解析xml文件，注解的方式管理bean则不会走到这个委派）。<code>parseBeanDefinitions(root,this.delegate)</code>，会传入一个delegate，之后的解析工作都是通过delegate作为主要角色来完成的。在这个过程中，<strong>delegate会对不同的element委派的相应的类进行注册操作</strong>，而注册操作又委托给了BeanDefinitionReaderUtils</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">delegate通过不同的标签类型，进行不同的注册操作</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">parseDefaultElement</span><span class="params">(Element ele, BeanDefinitionParserDelegate delegate)</span> &#123;</span><br><span class="line">    <span class="comment">//import标签</span></span><br><span class="line">    <span class="keyword">if</span> (delegate.nodeNameEquals(ele, IMPORT_ELEMENT)) &#123;</span><br><span class="line">        importBeanDefinitionResource(ele);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//alias标签</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (delegate.nodeNameEquals(ele, ALIAS_ELEMENT)) &#123;</span><br><span class="line">        processAliasRegistration(ele);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//bean标签</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (delegate.nodeNameEquals(ele, BEAN_ELEMENT)) &#123;</span><br><span class="line">        processBeanDefinition(ele, delegate);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//beans标签</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (delegate.nodeNameEquals(ele, NESTED_BEANS_ELEMENT)) &#123;</span><br><span class="line">        <span class="comment">// recurse</span></span><br><span class="line">        doRegisterBeanDefinitions(ele);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>Spring MVC中的DispatcherServlet类。针对输入的url请求，委派给相应的Handler（适配器模式，DispatcherServletAdapter）处理，让对应的handler执行hander。</p>
</li>
</ul>
<hr>
<p>后面进入bean标签的解析及注册……</p>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Spring%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/" rel="tag"># Spring源码解析</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/10/29/16-24-52/" rel="prev" title="hexo命令">
      <i class="fa fa-chevron-left"></i> hexo命令
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E7%9B%AE%E7%9A%84"><span class="nav-number">1.</span> <span class="nav-text">一、目的</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%9A%84%E8%AF%BB%E5%8F%96%E5%92%8C%E5%B0%81%E8%A3%85"><span class="nav-number">2.</span> <span class="nav-text">二、配置文件的读取和封装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-URL-amp-Resource%E7%B1%BB"><span class="nav-number">2.1.</span> <span class="nav-text">2.1 URL &amp; Resource类</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-InputStreamSource"><span class="nav-number">2.2.</span> <span class="nav-text">2.2 InputStreamSource</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-Resource%E6%8E%A5%E5%8F%A3"><span class="nav-number">2.3.</span> <span class="nav-text">2.3 Resource接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-ClassPathResource"><span class="nav-number">2.4.</span> <span class="nav-text">2.4 ClassPathResource</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81XmlBeanFactory%E7%9A%84%E5%AE%9E%E7%8E%B0"><span class="nav-number">3.</span> <span class="nav-text">三、XmlBeanFactory的实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-XmlBeanFactory-%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 XmlBeanFactory 初始化</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-1-1-%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D"><span class="nav-number">3.1.1.</span> <span class="nav-text">3.1.1 自动装配</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E5%8A%A0%E8%BD%BDbean"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 加载bean</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-XML%E7%9A%84%E9%AA%8C%E8%AF%81%E6%A8%A1%E5%BC%8F-amp-%E8%8E%B7%E5%8F%96"><span class="nav-number">3.2.1.</span> <span class="nav-text">3.2.1 XML的验证模式 &amp; 获取</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E8%8E%B7%E5%8F%96Document"><span class="nav-number">3.3.</span> <span class="nav-text">3.3 获取Document</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-1-EntityResolver-%E6%8E%A5%E5%8F%A3"><span class="nav-number">3.3.1.</span> <span class="nav-text">3.3.1 EntityResolver 接口</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-%E8%A7%A3%E6%9E%90%E5%8F%8A%E6%B3%A8%E5%86%8CBeanDefinitions"><span class="nav-number">3.4.</span> <span class="nav-text">3.4 解析及注册BeanDefinitions</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-1-profile%E5%B1%9E%E6%80%A7%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">3.4.1.</span> <span class="nav-text">3.4.1 profile属性的使用</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-4-2-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%EF%BC%88%E5%A7%94%E6%B4%BE%E6%A8%A1%E5%BC%8F%EF%BC%89"><span class="nav-number">3.4.2.</span> <span class="nav-text">3.4.2  设计模式（委派模式）</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="wuyongjiang"
      src="/uploads/avater.jpeg">
  <p class="site-author-name" itemprop="name">wuyongjiang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">2</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">wuyongjiang</span>
</div>
<!--
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>
-->
        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>

<script src="/js/utils.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
